<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>powdr</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="hello_world.html"><strong aria-hidden="true">2.</strong> Hello World</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="cli/index.html"><strong aria-hidden="true">3.</strong> CLI</a></li><li class="chapter-item expanded "><a href="asm/index.html"><strong aria-hidden="true">4.</strong> asm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="asm/machines.html"><strong aria-hidden="true">4.1.</strong> Machines</a></li><li class="chapter-item expanded "><a href="asm/registers.html"><strong aria-hidden="true">4.2.</strong> Registers</a></li><li class="chapter-item expanded "><a href="asm/functions.html"><strong aria-hidden="true">4.3.</strong> Functions</a></li><li class="chapter-item expanded "><a href="asm/expressions.html"><strong aria-hidden="true">4.4.</strong> Expressions</a></li><li class="chapter-item expanded "><a href="asm/instructions.html"><strong aria-hidden="true">4.5.</strong> Instructions</a></li></ol></li><li class="chapter-item expanded "><a href="pil/index.html"><strong aria-hidden="true">5.</strong> PIL</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pil/fixed_columns.html"><strong aria-hidden="true">5.1.</strong> Fixed Columns</a></li><li class="chapter-item expanded "><a href="pil/macros.html"><strong aria-hidden="true">5.2.</strong> Macros</a></li></ol></li><li class="chapter-item expanded "><a href="linker/index.html"><strong aria-hidden="true">6.</strong> Linker</a></li><li class="chapter-item expanded "><a href="frontends/index.html"><strong aria-hidden="true">7.</strong> Frontends</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="frontends/riscv.html"><strong aria-hidden="true">7.1.</strong> RISCV</a></li><li class="chapter-item expanded "><a href="frontends/valida.html"><strong aria-hidden="true">7.2.</strong> Valida</a></li><li class="chapter-item expanded "><a href="frontends/evm.html"><strong aria-hidden="true">7.3.</strong> EVM</a></li></ol></li><li class="chapter-item expanded "><a href="backends/index.html"><strong aria-hidden="true">8.</strong> Backends</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="backends/halo2.html"><strong aria-hidden="true">8.1.</strong> Halo2</a></li><li class="chapter-item expanded "><a href="backends/estark.html"><strong aria-hidden="true">8.2.</strong> eSTARK</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">powdr</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>powdr</strong> is a modular compiler stack to build zkVMs.
It is ideal for implementing existing VMs and experimenting with new designs with minimal boilerplate.</p>
<ul>
<li>Domain specific languages are used to specify the VM and its underlying constraints, not low level Rust code</li>
<li>Automated witness generation</li>
<li>Support for multiple provers as well as aggregation schemes</li>
<li>Support for hand-optimized co-processors when performance is critical</li>
<li>Built in Rust ðŸ¦€</li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>powdr is free and open source. You can find the source code on
<a href="https://github.com/powdr-labs/powdr">GitHub</a>. Issues and feature requests can be posted on
the <a href="https://github.com/powdr-labs/powdr/issues">GitHub issue tracker</a>.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<!-- markdown-link-check-disable-next-line -->
<p>The powdr source and documentation are released under the <a href="https://opensource.org/license/mit/">MIT License</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>The only way to install powdr currently is to build it from source.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>You will need the <a href="https://rust-lang.org">Rust</a> compiler and Cargo, the Rust package manager.
The easiest way to install both is with <a href="https://rustup.rs/"><code>rustup.rs</code></a>.</p>
<p>On Windows, you will also need a recent version of <a href="https://visualstudio.microsoft.com/downloads/">Visual Studio</a>,
installed with the &quot;Desktop Development With C++&quot; Workloads option.</p>
<h2 id="building"><a class="header" href="#building">Building</a></h2>
<p>Using a single Cargo command:</p>
<pre><code class="language-sh">cargo install --git https://github.com/powdr-labs/powdr powdr_cli
</code></pre>
<p>Or, by manually building from a local copy of the <a href="https://github.com/powdr-labs/powdr">powdr repository</a>:</p>
<pre><code class="language-sh"># clone the repository
git clone https://github.com/powdr-labs/powdr.git
cd powdr
# install powdr_cli
cargo install --path ./powdr_cli
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world"><a class="header" href="#hello-world">Hello World</a></h1>
<p>Let's write <a href="https://github.com/powdr-labs/powdr/blob/main/test_data/asm/book/hello_world.asm">a minimal VM</a> and generate a SNARK!</p>
<pre><code>machine HelloWorld {

    degree 8;

    // this simple machine does not have submachines

    reg pc[@pc];
    reg X[&lt;=];
    reg Y[&lt;=];
    reg A;

    instr incr X -&gt; Y {
        Y = X + 1
    }

    instr decr X -&gt; Y {
        Y = X - 1
    }

    instr assert_zero X {
        X = 0
    }

    constraints {
        // in this machine, we do not add more constraints
    }

    // the main function assigns the first prover input to A, increments it, decrements it, and loops forever
    function main {
        A &lt;=X= ${ (&quot;input&quot;, 0) };
        A &lt;== incr(A);
        A &lt;== decr(A);
        assert_zero A;
        return;
    }
}
</code></pre>
<p>Then let's generate a proof of execution for the valid prover input <code>0</code> (since for <code>0 + 1 - 1 == 0</code>)</p>
<pre><code class="language-console">powdr pil hello_world.asm --field bn254 --force --inputs 0 --prove-with halo2
</code></pre>
<p>We observe that a proof was created at <code>proof.bin</code>.
Now let's try for the invalid input <code>1</code></p>
<pre><code class="language-console">powdr pil hello_world.asm --field bn254 --force --inputs 1 --prove-with halo2
</code></pre>
<p>We observe that witness generation fails, and no proof is created.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-help-for-powdr"><a class="header" href="#command-line-help-for-powdr">Command-Line Help for <code>powdr</code></a></h1>
<p>This document contains the help content for the <code>powdr</code> command-line program.</p>
<p><strong>Command Overview:</strong></p>
<ul>
<li><a href="cli/index.html#powdr"><code>powdr</code>â†´</a></li>
<li><a href="cli/index.html#powdr-pil"><code>powdr pil</code>â†´</a></li>
<li><a href="cli/index.html#powdr-rust"><code>powdr rust</code>â†´</a></li>
<li><a href="cli/index.html#powdr-riscv-asm"><code>powdr riscv-asm</code>â†´</a></li>
<li><a href="cli/index.html#powdr-prove"><code>powdr prove</code>â†´</a></li>
<li><a href="cli/index.html#powdr-setup"><code>powdr setup</code>â†´</a></li>
<li><a href="cli/index.html#powdr-reformat"><code>powdr reformat</code>â†´</a></li>
<li><a href="cli/index.html#powdr-optimize-pil"><code>powdr optimize-pil</code>â†´</a></li>
</ul>
<h2 id="powdr"><a class="header" href="#powdr"><code>powdr</code></a></h2>
<p><strong>Usage:</strong> <code>powdr [COMMAND]</code></p>
<h6 id="subcommands"><a class="header" href="#subcommands"><strong>Subcommands:</strong></a></h6>
<ul>
<li><code>pil</code> â€” Runs compilation and witness generation for .pil and .asm files. First converts .asm files to .pil, if needed. Then converts the .pil file to json and generates fixed and witness column data files</li>
<li><code>rust</code> â€” Compiles (no-std) rust code to riscv assembly, then to powdr assembly and finally to PIL and generates fixed and witness columns. Needs <code>rustup target add riscv32imc-unknown-none-elf</code></li>
<li><code>riscv-asm</code> â€” Compiles riscv assembly to powdr assembly and then to PIL and generates fixed and witness columns</li>
<li><code>prove</code> â€” </li>
<li><code>setup</code> â€” </li>
<li><code>reformat</code> â€” Parses and prints the PIL file on stdout</li>
<li><code>optimize-pil</code> â€” Optimizes the PIL file and outputs it on stdout</li>
</ul>
<h6 id="options"><a class="header" href="#options"><strong>Options:</strong></a></h6>
<ul>
<li><code>--markdown-help</code></li>
</ul>
<h2 id="powdr-pil"><a class="header" href="#powdr-pil"><code>powdr pil</code></a></h2>
<p>Runs compilation and witness generation for .pil and .asm files. First converts .asm files to .pil, if needed. Then converts the .pil file to json and generates fixed and witness column data files</p>
<p><strong>Usage:</strong> <code>powdr pil [OPTIONS] &lt;FILE&gt;</code></p>
<h6 id="arguments"><a class="header" href="#arguments"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;FILE&gt;</code> â€” Input file</li>
</ul>
<h6 id="options-1"><a class="header" href="#options-1"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--field &lt;FIELD&gt;</code> â€” The field to use</p>
<p>Default value: <code>gl</code></p>
<p>Possible values: <code>gl</code>, <code>bn254</code></p>
</li>
<li>
<p><code>-o</code>, <code>--output-directory &lt;OUTPUT_DIRECTORY&gt;</code> â€” Output directory for the PIL file, json file and fixed and witness column data</p>
<p>Default value: <code>.</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inputs &lt;INPUTS&gt;</code> â€” Comma-separated list of free inputs (numbers). Assumes queries to have the form (&quot;input&quot;, <index>)</p>
<p>Default value: ``</p>
</li>
<li>
<p><code>-f</code>, <code>--force</code> â€” Force overwriting of PIL output file</p>
<p>Default value: <code>false</code></p>
</li>
<li>
<p><code>-p</code>, <code>--prove-with &lt;PROVE_WITH&gt;</code> â€” Generate a proof with a given backend</p>
<p>Possible values: <code>pilcom-cli</code></p>
</li>
<li>
<p><code>--export-csv</code> â€” Generate a CSV file containing the fixed and witness column values. Useful for debugging purposes</p>
<p>Default value: <code>false</code></p>
</li>
<li>
<p><code>--csv-mode &lt;CSV_MODE&gt;</code> â€” How to render field elements in the csv file</p>
<p>Default value: <code>hex</code></p>
<p>Possible values: <code>i</code>, <code>ui</code>, <code>hex</code></p>
</li>
</ul>
<h2 id="powdr-rust"><a class="header" href="#powdr-rust"><code>powdr rust</code></a></h2>
<p>Compiles (no-std) rust code to riscv assembly, then to powdr assembly and finally to PIL and generates fixed and witness columns. Needs <code>rustup target add riscv32imc-unknown-none-elf</code></p>
<p><strong>Usage:</strong> <code>powdr rust [OPTIONS] &lt;FILE&gt;</code></p>
<h6 id="arguments-1"><a class="header" href="#arguments-1"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;FILE&gt;</code> â€” Input file (rust source file) or directory (containing a crate)</li>
</ul>
<h6 id="options-2"><a class="header" href="#options-2"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--field &lt;FIELD&gt;</code> â€” The field to use</p>
<p>Default value: <code>gl</code></p>
<p>Possible values: <code>gl</code>, <code>bn254</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inputs &lt;INPUTS&gt;</code> â€” Comma-separated list of free inputs (numbers)</p>
<p>Default value: ``</p>
</li>
<li>
<p><code>-o</code>, <code>--output-directory &lt;OUTPUT_DIRECTORY&gt;</code> â€” Directory for  output files</p>
<p>Default value: <code>.</code></p>
</li>
<li>
<p><code>-f</code>, <code>--force</code> â€” Force overwriting of files in output directory</p>
<p>Default value: <code>false</code></p>
</li>
<li>
<p><code>-p</code>, <code>--prove-with &lt;PROVE_WITH&gt;</code> â€” Generate a proof with a given backend</p>
<p>Possible values: <code>pilcom-cli</code></p>
</li>
</ul>
<h2 id="powdr-riscv-asm"><a class="header" href="#powdr-riscv-asm"><code>powdr riscv-asm</code></a></h2>
<p>Compiles riscv assembly to powdr assembly and then to PIL and generates fixed and witness columns</p>
<p><strong>Usage:</strong> <code>powdr riscv-asm [OPTIONS] &lt;FILES&gt;...</code></p>
<h6 id="arguments-2"><a class="header" href="#arguments-2"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;FILES&gt;</code> â€” Input files</li>
</ul>
<h6 id="options-3"><a class="header" href="#options-3"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--field &lt;FIELD&gt;</code> â€” The field to use</p>
<p>Default value: <code>gl</code></p>
<p>Possible values: <code>gl</code>, <code>bn254</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inputs &lt;INPUTS&gt;</code> â€” Comma-separated list of free inputs (numbers)</p>
<p>Default value: ``</p>
</li>
<li>
<p><code>-o</code>, <code>--output-directory &lt;OUTPUT_DIRECTORY&gt;</code> â€” Directory for output files</p>
<p>Default value: <code>.</code></p>
</li>
<li>
<p><code>-f</code>, <code>--force</code> â€” Force overwriting of files in output directory</p>
<p>Default value: <code>false</code></p>
</li>
<li>
<p><code>-p</code>, <code>--prove-with &lt;PROVE_WITH&gt;</code> â€” Generate a proof with a given backend</p>
<p>Possible values: <code>pilcom-cli</code></p>
</li>
</ul>
<h2 id="powdr-prove"><a class="header" href="#powdr-prove"><code>powdr prove</code></a></h2>
<p><strong>Usage:</strong> <code>powdr prove [OPTIONS] --backend &lt;BACKEND&gt; &lt;FILE&gt;</code></p>
<h6 id="arguments-3"><a class="header" href="#arguments-3"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;FILE&gt;</code> â€” Input PIL file</li>
</ul>
<h6 id="options-4"><a class="header" href="#options-4"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>-d</code>, <code>--dir &lt;DIR&gt;</code> â€” Directory to find the committed and fixed values</p>
<p>Default value: <code>.</code></p>
</li>
<li>
<p><code>--field &lt;FIELD&gt;</code> â€” The field to use</p>
<p>Default value: <code>gl</code></p>
<p>Possible values: <code>gl</code>, <code>bn254</code></p>
</li>
<li>
<p><code>-b</code>, <code>--backend &lt;BACKEND&gt;</code> â€” Generate a proof with a given backend</p>
<p>Possible values: <code>pilcom-cli</code></p>
</li>
<li>
<p><code>--proof &lt;PROOF&gt;</code> â€” File containing previously generated proof for aggregation</p>
</li>
<li>
<p><code>--params &lt;PARAMS&gt;</code> â€” File containing previously generated setup parameters</p>
</li>
</ul>
<h2 id="powdr-setup"><a class="header" href="#powdr-setup"><code>powdr setup</code></a></h2>
<p><strong>Usage:</strong> <code>powdr setup [OPTIONS] --backend &lt;BACKEND&gt; &lt;SIZE&gt;</code></p>
<h6 id="arguments-4"><a class="header" href="#arguments-4"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;SIZE&gt;</code> â€” Size of the parameters</li>
</ul>
<h6 id="options-5"><a class="header" href="#options-5"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>-d</code>, <code>--dir &lt;DIR&gt;</code> â€” Directory to output the generated parameters</p>
<p>Default value: <code>.</code></p>
</li>
<li>
<p><code>--field &lt;FIELD&gt;</code> â€” The field to use</p>
<p>Default value: <code>gl</code></p>
<p>Possible values: <code>gl</code>, <code>bn254</code></p>
</li>
<li>
<p><code>-b</code>, <code>--backend &lt;BACKEND&gt;</code> â€” Generate a proof with a given backend</p>
<p>Possible values: <code>pilcom-cli</code></p>
</li>
</ul>
<h2 id="powdr-reformat"><a class="header" href="#powdr-reformat"><code>powdr reformat</code></a></h2>
<p>Parses and prints the PIL file on stdout</p>
<p><strong>Usage:</strong> <code>powdr reformat &lt;FILE&gt;</code></p>
<h6 id="arguments-5"><a class="header" href="#arguments-5"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;FILE&gt;</code> â€” Input file</li>
</ul>
<h2 id="powdr-optimize-pil"><a class="header" href="#powdr-optimize-pil"><code>powdr optimize-pil</code></a></h2>
<p>Optimizes the PIL file and outputs it on stdout</p>
<p><strong>Usage:</strong> <code>powdr optimize-pil [OPTIONS] &lt;FILE&gt;</code></p>
<h6 id="arguments-6"><a class="header" href="#arguments-6"><strong>Arguments:</strong></a></h6>
<ul>
<li><code>&lt;FILE&gt;</code> â€” Input file</li>
</ul>
<h6 id="options-6"><a class="header" href="#options-6"><strong>Options:</strong></a></h6>
<ul>
<li>
<p><code>--field &lt;FIELD&gt;</code> â€” The field to use</p>
<p>Default value: <code>gl</code></p>
<p>Possible values: <code>gl</code>, <code>bn254</code></p>
</li>
</ul>
<hr/>
<p><small><i>
This document was generated automatically by
<a href="https://crates.io/crates/clap-markdown"><code>clap-markdown</code></a>.
</i></small></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="asm"><a class="header" href="#asm">asm</a></h1>
<p>powdr asm is the higher level of abstraction in powdr. It allows defining Instruction Set Architectures (ISA) using dynamic and static machines.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="machines"><a class="header" href="#machines">Machines</a></h1>
<p>Machines are the first main concept in powdr asm. They can currently be of two types: dynamic or static.</p>
<h2 id="dynamic-machines"><a class="header" href="#dynamic-machines">Dynamic machines</a></h2>
<p>Dynamic machines are defined by:</p>
<ul>
<li>a degree, indicating the number of execution steps</li>
<li>a set of registers, including a program counter</li>
<li>an instruction set</li>
<li>constraints</li>
<li>a set of functions</li>
<li>a set of submachines</li>
</ul>
<blockquote>
<p>Dynamic machines are currently limited to having a single function called <code>main</code></p>
</blockquote>
<p>An example of a simple dynamic machine is the following:</p>
<pre><code>machine HelloWorld {

    degree 8;

    // this simple machine does not have submachines

    reg pc[@pc];
    reg X[&lt;=];
    reg Y[&lt;=];
    reg A;

    instr incr X -&gt; Y {
        Y = X + 1
    }

    instr decr X -&gt; Y {
        Y = X - 1
    }

    instr assert_zero X {
        X = 0
    }

    constraints {
        // in this machine, we do not add more constraints
    }

    // the main function assigns the first prover input to A, increments it, decrements it, and loops forever
    function main {
        A &lt;=X= ${ (&quot;input&quot;, 0) };
        A &lt;== incr(A);
        A &lt;== decr(A);
        assert_zero A;
        return;
    }
}
</code></pre>
<h2 id="static-machines"><a class="header" href="#static-machines">Static machines</a></h2>
<p>Static machines are a lower-level type of machine. They do not have registers, and instead rely on simple committed and fixed columns. They are used to implement hand-optimized computation.</p>
<p>They are defined by:</p>
<ul>
<li>a degree, indicating the number of execution steps</li>
<li>a set of functions</li>
<li>a function identifier column, used to make constraints conditional over which function is called</li>
<li>a latch column, used to identify rows at which the machine can be accessed from the outside (where the inputs and outputs are passed)</li>
</ul>
<p>An example of a simple static machine is the following:</p>
<pre><code>machine SimpleStatic(latch, function_id) {

    degree 8;

    function power_4&lt;0&gt; x -&gt; y {        
    }

    constraints {
        col fixed function_id = [0]*;
        col fixed latch = [0, 0, 0, 1]*;
        col witness x;
        col witness y;

        // initialise y to x at the beginning of each block
        latch * (y' - x') = 0;
        // x is unconstrained at the beginning of the block

        // x is constant within a block
        (1 - latch) * (x' - x) = 0;
        // y is multiplied by x at each row
        (1 - latch) * (y' - x * y) = 0;
    }
}
</code></pre>
<p>For more details on the constraints, check out the <a href="asm/../pil">pil</a> section of this book. Note that the parameters of the function are columns declared within the constraints block.</p>
<h2 id="submachines"><a class="header" href="#submachines">Submachines</a></h2>
<p>Machines can have submachines which they access by defining <a href="asm/./instructions.html">external instructions</a>. They are declared as follows:</p>
<pre><code>machine MySubmachine {
    ...
}

machine MyMachine {
    MySubmachine my_submachine;
}
</code></pre>
<blockquote>
<p>Currently only dynamic machines can have submachines, and these must be static</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="registers"><a class="header" href="#registers">Registers</a></h1>
<p>Registers are central to a machine. powdr supports a few types of registers:</p>
<h2 id="program-counter"><a class="header" href="#program-counter">Program counter</a></h2>
<p>Each machine can have at most one program counter. In the absence of a program counter, the machine is considered static, and no other register can be declared. The program counter is defined as follows:</p>
<pre><code>reg pc[@pc]
</code></pre>
<p>At each step execution step, the program counter points to the <a href="asm/./functions.html">function</a> line to execute.
The program counter behaves like a <a href="asm/registers.html#write-registers">write register</a>, with the exception that its value is incremented by default after each step.</p>
<h2 id="write-registers"><a class="header" href="#write-registers">Write registers</a></h2>
<p>Write registers are the default type for registers. They are declared as follows:</p>
<pre><code>reg A;
</code></pre>
<p>They hold a field element, are initialized as 0 at the beginning of a function and keep their value by default. They can be read from and written to.</p>
<pre><code>// write to A
A &lt;=X= 1;
// A is 1

// read from A
B &lt;=X= A;
// A is still 1
</code></pre>
<h2 id="assignment-registers"><a class="header" href="#assignment-registers">Assignment registers</a></h2>
<p>Assignment registers are transient to an execution step: their value is not persisted across steps. They are required in order to pass inputs and receive outputs from instructions, as well as in assignments.
For example, if we want to assert that write register <code>A</code> is <code>0</code>, we can use the following instruction:</p>
<pre><code>reg pc[@pc];
reg A;

instr assert_A_is_zero {
    A = 0
}

function main {
    assert_A_is_zero;
    return;
}
</code></pre>
<p>However, if we want the instruction to accept any write register as input, we use an assignment register.</p>
<pre><code>reg pc[@pc];
reg X[&lt;=];
reg A;    

instr assert_zero X {
    X = 0
}

function main {
    assert_zero A;
    return;
}
</code></pre>
<h2 id="read-only-registers"><a class="header" href="#read-only-registers">Read-only registers</a></h2>
<p>Read-only registers are used for function inputs. However, powdr creates them automatically based on functions arguments, so that they do not need to be declared explicitly.</p>
<blockquote>
<p>Read-only registers are only mentioned for completeness here and are currently only used inside the compiler. We advise against using them.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functions"><a class="header" href="#functions">Functions</a></h1>
<p>Machine functions are the entry points to a machine. They can be called from another machine or from the outside.</p>
<p>For static machines, functions simply indicate which columns should be exposed as inputs and outputs. They do not contain statements, since the business logic of all functions in a static machine is defined directly in constraints. We refer to the previous example <a href="asm/./machines.html#static-machines">here</a>.</p>
<p>In the rest of this section, we describe functions in dynamic machines with the example of this simple machine:</p>
<pre><code>
machine Machine {

    degree 256;

    reg pc[@pc];
    reg X[&lt;=];
    reg Y[&lt;=];
    reg CNT;
    reg A;

    // an instruction to assert that a number is zero
    instr assert_zero X {
        X = 0
    }

    // an instruction to jump to a label
    instr jmp l: label {
        pc' = l 
    }

    // an instruction to jump to a label iff `X` is `0`, otherwise continue
    instr jmpz X, l: label { 
        pc' = XIsZero * l + (1 - XIsZero) * (pc + 1) 
    }
    
    // an instruction to return the square of an input
    instr square X -&gt; Y {
        Y = X * X
    }

    function main {
        // initialise `A` to 2
        A &lt;=X= 2;
        // initialise `CNT` to `3`
        CNT &lt;=X= 3;
        start::
        // if `CNT` is `0`, jump to `end`
        jmpz CNT, end;
        // decrement `CNT`
        CNT &lt;=X= CNT - 1;
        // square `A`
        A &lt;== square(A);
        // jump back to `start`
        jmp start;
        end::
        // check that `A == ((2**2)**2)**2`
        assert_zero A - ((2**2)**2)**2;
        return;
    }

    // some superpowers on `X` to allow us to check if it's 0
    constraints {
        col witness XInv;
        col witness XIsZero;
        XIsZero  = 1 - X * XInv;
        XIsZero * X = 0;
        XIsZero * (1 - XIsZero) = 0;
    }
}

</code></pre>
<h2 id="function-inputs-and-outputs"><a class="header" href="#function-inputs-and-outputs">Function inputs and outputs</a></h2>
<blockquote>
<p>For dynamic machines, function inputs and outputs are not supported yet</p>
</blockquote>
<h2 id="statements"><a class="header" href="#statements">Statements</a></h2>
<h3 id="labels"><a class="header" href="#labels">Labels</a></h3>
<p>Labels allow referring to a location in a function by name.</p>
<pre><code>        start::
</code></pre>
<h3 id="assignments"><a class="header" href="#assignments">Assignments</a></h3>
<p>Assignments allow setting the value of a write register to the value of an <a href="asm/functions.html#expressions">expression</a> using an assignment register.</p>
<pre><code>        A &lt;== square(A);
</code></pre>
<p>One important requirement is for the assignment register of the assignment to be compatible with that of the expression. This is especially relevant for instructions: the assignment register of the instruction output must match that of the assignment. In this example, we use <code>Y</code> in the assignment as the output of <code>square</code> is <code>Y</code>:</p>
<pre><code>    instr square X -&gt; Y {
        Y = X * X
    }
</code></pre>
<h3 id="instructions"><a class="header" href="#instructions">Instructions</a></h3>
<p>Instructions which do not return outputs can be used as statements.</p>
<pre><code>        assert_zero A - ((2**2)**2)**2;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="expressions"><a class="header" href="#expressions">Expressions</a></h1>
<h2 id="field-element-literals"><a class="header" href="#field-element-literals">Field element literals</a></h2>
<p>Field element literals are signed elements of the prime field.</p>
<pre><code>        CNT &lt;=X= 3;
</code></pre>
<h2 id="registers-and-columns"><a class="header" href="#registers-and-columns">Registers and columns</a></h2>
<p>Registers can be used as expressions, with the exception of assignment registers.</p>
<pre><code>        CNT &lt;=X= CNT - 1;
</code></pre>
<h2 id="instructions-1"><a class="header" href="#instructions-1">Instructions</a></h2>
<p>Instructions which return outputs can be used as expressions.</p>
<pre><code>        A &lt;== square(A);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="instructions-2"><a class="header" href="#instructions-2">Instructions</a></h1>
<p>Instructions are declared as part of a powdr asm machine. Their inputs and outputs are <a href="asm/./registers.html">assignment registers</a> as well as labels. Once defined, they can be called by any function of this machine.</p>
<h1 id="local-instructions"><a class="header" href="#local-instructions">Local instructions</a></h1>
<p>A local instruction is the simplest type of instruction. It is called local because its behavior is defined using constraints over registers and columns of the machine it is defined in.</p>
<pre><code>instr add X, Y -&gt; Z {
    X + Y = Z
}
</code></pre>
<p>Instructions feature:</p>
<ul>
<li>a name</li>
<li>some inputs</li>
<li>some outputs</li>
<li>a set of PIL constraints to activate when the instruction is called</li>
</ul>
<h1 id="external-instructions"><a class="header" href="#external-instructions">External instructions</a></h1>
<p>An external instruction delegates calls to a function inside a submachine of this machine. When it is called, a call is made to the submachine function. An example of an external instruction is the following:</p>
<pre><code>instr assert_zero X = my_submachine.assert_zero // where `assert_zero` is a function defined in `my_submachine`
</code></pre>
<p>Note that external instructions cannot link to functions of the same machine: they delegate computation to a submachine.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pil"><a class="header" href="#pil">PIL</a></h1>
<p>powdr PIL is the lower level of abstraction in powdr. It is strongly inspired by and compatible with <a href="https://github.com/0xPolygonHermez/pilcom/">Polygon zkEVM PIL</a>. We refer to the <a href="https://zkevm.polygon.technology/PIL/introduction">Polygon zkEVM PIL documentation</a> and document deviations from the original design here.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fixed-columns"><a class="header" href="#fixed-columns">Fixed columns</a></h1>
<p>powdr PIL requires the definition of fixed columns at the time of declaration.</p>
<p>For example:</p>
<pre><code>col fixed ONES = [1]*; // this is valid
// col fixed ONES; // this is invalid
</code></pre>
<p>A number of mechanisms are supported to declare fixed columns. Let <code>N</code> be the total length of the column we're defining.</p>
<h2 id="values-with-repetitions"><a class="header" href="#values-with-repetitions">Values with repetitions</a></h2>
<p>powdr PIL supports a basic language to define the value of constant columns using:</p>
<ul>
<li>arrays, for example <code>[1, 2, 3]</code></li>
<li>repetition, for example <code>[1, 2]*</code></li>
<li>concatenation, for example <code>[1, 2] + [3, 4]</code></li>
</ul>
<p>These mechanisms can be combined, as long as a single repetition is used per column definition.</p>
<pre><code>// valid, as for a given total length, only one column fits this definition for a given `N`
col fixed A = [1, 2] + [3, 4]* + [5];

// invalid, as many columns fit this definition
// col fixed A = [1, 2]* + [3, 4]*
</code></pre>
<h2 id="mappings"><a class="header" href="#mappings">Mappings</a></h2>
<p>A column can be seen as a mapping from integers to field elements. In this context, different functions are supported:</p>
<pre><code>col fixed B(i) { i + 1 };

col fixed C(i) {match i {
    0 =&gt; 1,
    _ =&gt; 0
}};
</code></pre>
<blockquote>
<p>Note that conversion from integer to field element is currently implicit, as seen in the first example above.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macros"><a class="header" href="#macros">Macros</a></h1>
<p>powdr PIL exposes a macro system which can generate arbitrary powdr PIL code.</p>
<h2 id="definition"><a class="header" href="#definition">Definition</a></h2>
<p>Let's define some macros which generate powdr PIL expressions:</p>
<pre><code>macro is_nonzero(X) { match X { 0 =&gt; 0, _ =&gt; 1, } };
macro is_zero(X) { 1 - is_nonzero(X) };
macro is_equal(A, B) { is_zero(A - B) };
macro is_one(X) { is_equal(X, 1) };
macro ite(C, A, B) { is_nonzero(C) * A + is_zero(C) * B};
macro one_hot(i, index) { ite(is_equal(i, index), 1, 0) };
</code></pre>
<p>In particular, we can generate constraints inside macros:</p>
<pre><code>macro constrain_equal_expr(A, B) { A - B };
macro force_equal_on_last_row(poly, value) { ISLAST * constrain_equal_expr(poly, value) = 0; };
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<blockquote>
<p>Macros currently have global scope</p>
</blockquote>
<p>Usage of the defined macros happens as expected in powdr PIL code:</p>
<pre><code>pol constant ISLAST(i) { one_hot(i, %last_row) };
</code></pre>
<p>Generating constraints:</p>
<pre><code>force_equal_on_last_row(x', 1);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linker"><a class="header" href="#linker">Linker</a></h1>
<p>powdr machine instances are compiled into separate AIRs, where each consists of:</p>
<ul>
<li>an optional degree</li>
<li>a list of PIL statements</li>
<li>a list of links to other machine instances</li>
</ul>
<p>A linker is used to turn this tree of AIRs into a structure we can generate proofs about. This currently takes the form of a single PIL file.
The linking process operates in the following way:</p>
<ol>
<li>Create an empty PIL file</li>
<li>Start from the main AIR. If it defines a degree, we call it <code>main_degree</code>. If it does not, set it to the default of <code>1024</code>.</li>
<li>For each AIR
<ol>
<li>Create a new namespace in the PIL file</li>
<li>If a degree is defined, check that it matches <code>main_degree</code>. If no degree is defined, set the degree to <code>main_degree</code>.</li>
<li>Add the constraints to the namespace</li>
<li>Turn the links into lookups and add them to the namespace</li>
</ol>
</li>
</ol>
<p>The result is a monolithic AIR where each machine instance is a namespace, where all namespaces have the same degree and links between instances are guaranteed by lookup identities.</p>
<blockquote>
<p>More flexible approaches to the linking process will be explored in the future, such as allowing for machine instances of different degrees.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="frontends"><a class="header" href="#frontends">Frontends</a></h1>
<p>While any frontend VM can be implemented in powdr asm, powdr comes with several frontends for popular instruction set architectures.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="riscv"><a class="header" href="#riscv">RISCV</a></h1>
<p>A <a href="https://riscv.org/technical/specifications/">RISCV</a> frontend for powdr is already available.</p>
<h2 id="how-to-run-the-rust-riscv-example"><a class="header" href="#how-to-run-the-rust-riscv-example">How to run the Rust-RISCV example</a></h2>
<pre><code class="language-sh"># Install the riscv target for the rust compiler
rustup target add riscv32imc-unknown-none-elf
# Run the compiler. It will generate files in /tmp/.
# -i specifies the prover witness input (see below)
powdr rust riscv/tests/riscv_data/sum.rs -o /tmp -f -i 10,2,4,6 
</code></pre>
<p>The following example Rust file verifies that a supplied list of integers sums up to a specified value.
Note that this is the full and only input file you need for the whole process!</p>
<pre><pre class="playground"><code class="language-rust">#![no_std]

extern crate alloc;
use alloc::vec::Vec;

use runtime::get_prover_input;

#[no_mangle]
pub fn main() {
    // This is the sum claimed by the prover.
    let proposed_sum = get_prover_input(0);
    // The number of integers we want to sum.
    let len = get_prover_input(1) as usize;
    // Read the numbers from the prover and store them
    // in a vector.
    let data: Vec&lt;_&gt; = (2..(len + 2))
        .map(|idx| get_prover_input(idx as u32))
        .collect();
    // Compute the sum.
    let sum: u32 = data.iter().sum();
    // Check that our sum matches the prover's.
    assert_eq!(sum, proposed_sum);
}</code></pre></pre>
<p>The function <code>get_prover_input</code> reads a number from the list supplied with <code>-i</code>.</p>
<p>This is just a first mechanism to provide access to the outside world.
The plan is to be able to call arbitrary user-defined <code>ffi</code> functions that will translate to prover queries,
and can then ask for e.g. the value of a storage slot at a certain address or the root hash of a Merkle tree.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="valida"><a class="header" href="#valida">Valida</a></h1>
<p>A <a href="https://github.com/valida-xyz/valida-compiler/issues/2">Valida</a> front end for powdr is under development. If you are interested, feel free to <a href="https://matrix.to/#/#powdr:matrix.org">reach out</a>!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="evm"><a class="header" href="#evm">EVM</a></h1>
<p>An <a href="https://ethereum.org/en/developers/docs/evm/">EVM</a> frontend for powdr is under development. If you are interested, feel free to <a href="https://matrix.to/#/#powdr:matrix.org">reach out</a>!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backends"><a class="header" href="#backends">Backends</a></h1>
<p>powdr aims to have full flexibility when it comes to generating proofs and comes with a few built-in backends to get started with zkVMs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="halo2"><a class="header" href="#halo2">Halo2</a></h1>
<p>powdr supports the <a href="https://github.com/privacy-scaling-explorations/halo2">PSE fork of halo2</a> with the bn254 field.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="estark"><a class="header" href="#estark">eSTARK</a></h1>
<p>Integrated support for <a href="https://eprint.iacr.org/2023/474">eSTARK</a> with the Goldilocks field is under development.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
